<!doctype html><html lang=en-us dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Unlocking Angular Potential: Provide Root Services That Listen to Routing Events | Mart's blog</title>
<meta name=keywords content="Angular,typescript,singleton,design pattern,router,npm"><meta name=description content="Lets create a global singleton that listens to router events in Angular. Is it a good idea? Let&rsquo;s find out."><meta name=author content="Mart de Graaf"><link rel=canonical href=https://martdegraaf.github.io/posts/angular-singleton-services-listening-to-routing-events/><link crossorigin=anonymous href=/assets/css/stylesheet.193ab5cf408c423fff0a8ebcacf30ee80c3524cefbc27b2a2b22b145eb66619d.css integrity="sha256-GTq1z0CMQj//Co68rPMO6Aw1JM77wnsqKyKxRetmYZ0=" rel="preload stylesheet" as=style><link rel=icon href=https://martdegraaf.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://martdegraaf.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://martdegraaf.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://martdegraaf.github.io/apple-touch-icon.png><link rel=mask-icon href=https://martdegraaf.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en-us href=https://martdegraaf.github.io/posts/angular-singleton-services-listening-to-routing-events/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=text/javascript>!function(e,t,n){var s,o=e.location,f="script",m="connectionString",a="ingestionendpoint",d="disableExceptionTracking",l="ai.device.",c="toLowerCase",r="crossOrigin",u="POST",h="appInsightsSDK",i=n.name||"appInsights";(n.name||e[h])&&(e[h]=i),s=e[i]||function(s){var p,g,v,j,C,k=!1,b=!1,i={initialize:!0,queue:[],sv:"5",version:2,config:s};function y(e,t){var n={},s="Browser";return n[l+"id"]=s[c](),n[l+"type"]=s,n["ai.operation.name"]=o&&o.pathname||"_unknown_",n["ai.internal.sdkVersion"]="javascript:snippet_"+(i.sv||i.version),{time:function(){var e=new Date;function t(e){var t=""+e;return 1===t.length&&(t="0"+t),t}return e.getUTCFullYear()+"-"+t(1+e.getUTCMonth())+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+((e.getUTCMilliseconds()/1e3).toFixed(3)+"").slice(2,5)+"Z"}(),name:"Microsoft.ApplicationInsights."+e.replace(/-/g,"")+"."+t,sampleRate:100,tags:n,data:{baseData:{ver:2}}}}if(g=s.url||n.src,g){function E(){var r,l,d,h,f,p,v,j,_,w,O;k=!0,i.queue=[],b||(b=!0,l=g,h=function(){var t,n,o,i,r,e={},l=s.connectionString;if(l)for(o=l.split(";"),t=0;t<o.length;t++)n=o[t].split("="),2===n.length&&(e[n[0][c]()]=n[1]);return e[a]||(i=e.endpointsuffix,r=i?e.location:null,e[a]="https://"+(r?r+".":"")+"dc."+(i||"services.visualstudio.com")),e}(),f=h[m]||s[m]||"",p=h[a],r=p?p+"/v2/track":s.endpointUrl,(v=[]).push((d="SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details)",j=l,_=r,(O=(w=y(f,"Exception")).data).baseType="ExceptionData",O.baseData.exceptions=[{typeName:"SDKLoadFailed",message:d.replace(/\./g,"-"),hasFullStack:!1,stack:d+`
Snippet failed to load [`+j+`] -- Telemetry is disabled
Help Link: https://go.microsoft.com/fwlink/?linkid=2128109
Host: `+(o&&o.pathname||"_unknown_")+`
Endpoint: `+_,parsedStack:[]}],w)),v.push(function(e,t,n,s){var o,i=y(f,"Message"),a=i.data;return a.baseType="MessageData",o=a.baseData,o.message='AI (Internal): 99 message:"'+("SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details) ("+n+")").replace(/"/g,"")+'"',o.properties={endpoint:s},i}(0,0,l,r)),function(t,s){if(JSON){var o,i=e.fetch;i&&!n.useXhr?i(s,{method:u,body:JSON.stringify(t),mode:"cors"}):XMLHttpRequest&&(o=new XMLHttpRequest,o.open(u,s),o.setRequestHeader("Content-type","application/json"),o.send(JSON.stringify(t)))}}(v,r))}function w(e,t){b||setTimeout(function(){!t&&i.core||E()},500)}v=function(){var s,e=t.createElement(f);return e.src=g,s=n[r],!s&&""!==s||"undefined"==e[r]||(e[r]=s),e.onload=w,e.onerror=E,e.onreadystatechange=function(t,n){"loaded"!==e.readyState&&"complete"!==e.readyState||w(0,n)},e}(),n.ld<0?t.getElementsByTagName("head")[0].appendChild(v):setTimeout(function(){t.getElementsByTagName(f)[0].parentNode.appendChild(v)},n.ld||0)}try{i.cookie=t.cookie}catch{}function _(e){for(;e.length;)!function(e){i[e]=function(){var t=arguments;k||i.queue.push(function(){i[e].apply(i,t)})}}(e.pop())}var h="track",O="TrackPage",x="TrackEvent";return _([h+"Event",h+"PageView",h+"Exception",h+"Trace",h+"DependencyData",h+"Metric",h+"PageViewPerformance","start"+O,"stop"+O,"start"+x,"stop"+x,"addTelemetryInitializer","setAuthenticatedUserContext","clearAuthenticatedUserContext","flush"]),i.SeverityLevel={Verbose:0,Information:1,Warning:2,Error:3,Critical:4},C=(s.extensionConfig||{}).ApplicationInsightsAnalytics||{},!0!==s[d]&&!0!==C[d]&&(p="onerror",_(["_"+p]),j=e[p],e[p]=function(e,t,n,s,o){var a=j&&j(e,t,n,s,o);return!0!==a&&i["_"+p]({message:e,url:t,lineNumber:n,columnNumber:s,error:o}),a},s.autoExceptionInstrumented=!0),i}(n.cfg);function p(){n.onInit&&n.onInit(s)}(e[i]=s).queue&&0===s.queue.length?(s.queue.push(p),s.trackPageView({})):p()}(window,document,{src:"https://js.monitor.azure.com/scripts/b/ai.2.min.js",crossOrigin:"anonymous",cfg:{connectionString:"InstrumentationKey=90cb325b-804c-43a9-97dd-9f34e5a0be01;IngestionEndpoint=https://westeurope-5.in.applicationinsights.azure.com/;LiveEndpoint=https://westeurope.livediagnostics.monitor.azure.com/",autoTrackPageVisitTime:!0}})</script><link rel=stylesheet href=/css/github.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZFQGR29JJQ"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-ZFQGR29JJQ")}</script><meta property="og:url" content="https://martdegraaf.github.io/posts/angular-singleton-services-listening-to-routing-events/"><meta property="og:site_name" content="Mart's blog"><meta property="og:title" content="Unlocking Angular Potential: Provide Root Services That Listen to Routing Events"><meta property="og:description" content="Lets create a global singleton that listens to router events in Angular. Is it a good idea? Letâ€™s find out."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-12T22:00:00+01:00"><meta property="article:modified_time" content="2024-12-14T09:28:06+01:00"><meta property="article:tag" content="Angular"><meta property="article:tag" content="Typescript"><meta property="article:tag" content="Singleton"><meta property="article:tag" content="Design Pattern"><meta property="article:tag" content="Router"><meta property="article:tag" content="Npm"><meta property="og:image" content="https://martdegraaf.github.io/posts/angular-singleton-services-listening-to-routing-events/cover.webp"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://martdegraaf.github.io/posts/angular-singleton-services-listening-to-routing-events/cover.webp"><meta name=twitter:title content="Unlocking Angular Potential: Provide Root Services That Listen to Routing Events"><meta name=twitter:description content="Lets create a global singleton that listens to router events in Angular. Is it a good idea? Let&rsquo;s find out."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://martdegraaf.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Unlocking Angular Potential: Provide Root Services That Listen to Routing Events","item":"https://martdegraaf.github.io/posts/angular-singleton-services-listening-to-routing-events/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Unlocking Angular Potential: Provide Root Services That Listen to Routing Events","name":"Unlocking Angular Potential: Provide Root Services That Listen to Routing Events","description":"Lets create a global singleton that listens to router events in Angular. Is it a good idea? Let\u0026rsquo;s find out.","keywords":["Angular","typescript","singleton","design pattern","router","npm"],"articleBody":"In a project with over 50 Angular projects we had quite some duplicate code. The first thing you will think of is putting code in a NPM package. But that can be a challenge when some of the 50 had a different implementation.\nSystem context The applications we make are wizard like applications. We update the title on a route change. This is done by subscribing to the router events. In the Angular projects we had this code sample in the app.component.ts:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 public AppComponent{ public constructor(private router: Router, private titleService: Title) { this.handleRouterEvent(); } private handleRouterEvent(): void { this.router.events.pipe( takeUntill(this.destroy$), filter((event) : event is NavigationEnd =\u003e event instanceOf NavigationEnd) ).subscribe((event) =\u003e { this.titleService.setTitle(this.getTitle(event.url)); }); } } Solution The solution was found using the APP_INITIALIZER token. This token is used to run a function before the application is bootstrapped. When using this method we can create a singleton service that does not need to be depended upon in the constructor of the components.\nThe root listener 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 @Injectable({ providedIn: 'root' }) export class RouteHandlerService implements OnDestroy{ private destroy$ = new Subject\u003cvoid\u003e(); constructor( private router: Router, @Inject('ROUTE_HANDLING_LISTENERS') private subServices: RouteHandlerSubService[] ) { this.startListening(); } private startListening(): void { this.router.events.pipe( takeUntill(this.destroy$), filter((event) =\u003e event instanceof NavigationEnd), map((event) =\u003e event as NavigationEnd) ).subscribe((event) =\u003e { this.titleService.setTitle(this.getTitle(event.url)); }); } public ngOnDestroy(): void { this.destroy$.next(); this.destroy$.complete(); } } export function provideRouteHandler(...subServices: Provider[][]): Provider[] { return [ ...subServices.map((service) =\u003e service), { provide: APP_INITIALIZER, useFactory: (routeHandlerService: RouteHandlerService) =\u003e () =\u003e routeHandlerService, deps: [RouteHandlerService], multi: true } ]; } The sub services We have some actions that need to be done on navigation such as logging a page view and setting the title of the page. We can create a sub service for this. This sub service can be injected in the provideRouteHandler method.\nTitleService 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 @Injectable({ providedIn: 'root' }) export class TitleService implements RouteHandlerSubService { constructor(private titleService: Title) {} public handleRoute(event: NavigationEnd): void { this.titleService.setTitle(this.getTitle(event.url)); } } export function withTitleService(): Provider[] { return [ TitleService, { provide: 'ROUTE_HANDLING_LISTENERS', useExisting: TitleService, multi: true } ]; } PageViewLogger 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 @Injectable({ providedIn: 'root' }) export class PageViewLogger implements RouteHandlerSubService { constructor(private logger: LoggingService) {} public handleRoute(event: NavigationEnd): void { this.logger.logPageView(event.url); } } export function withPageViewLogger(): Provider[] { return [ PageViewLogger, { provide: 'ROUTE_HANDLING_LISTENERS', useExisting: PageViewLogger, multi: true } ]; } Implementing in your application By creating a provide method, we can configure any behaviour that is needed for that specific project. And by allowing parameters to implement this method we can extend even for specific business logic for that project. I got this idea when we migrated to a newer version of Angular and my eye fell on the provideRoutes method. This method is used to provide routes to the application. My solution is based on this method but implemented generic and simple.\nSo in your main.ts, you can now register the route handler like this:\n1 2 3 4 5 6 bootstapApplicaiton(AppComponent, { providers: [ ... provideRouteHandler(withTitleService(), withPageViewLogger()) ] }); This allows even consumers to hook into those events and write their own subservice for hanlding router events.\nConclusion and discussion Please donâ€™t use this as an golden hammer. Normally you would want to be as explicit as possible when subscribing to route events. In our case we removed complexity and variations in our codebase. Also I am not sure what kind of performance impact this has on applications. We use these subscriptions at root level, so it was a good fit for us.\nAlso if you are using my code here, please note it only supports NavigationEnd events. If you want to support more events, you should edit the design to support a method to in the service if it handles the event type. You could use the Event type from @Angular/router to do this.\n1 2 3 4 5 6 7 8 9 public startListening(): void { this.router.events.pipe( takeUntill(this.destroy$), ).subscribe((event) =\u003e { this.subServices .filter((service) =\u003e service.handles(event)) .forEach((service) =\u003e service.handle(event)); }); } Benefits The move of this duplicate code over all projects also resulted in a higher code coverage and less stress to test the same code over and over again, and creating variants of the same code. It feels a lot like the Loki show of Disney+ where there are multiple Lokis in the same universe. We just restored the sacred timeline by implementing and using the package.\nWe are flexible in the use of the provide method. Letâ€™s say only one service does not want to log page views in the same way, we can just remove the withPageViewLogger method from the provideRouteHandler method. A concrete example may be when logging to application insights in 90% of the projects and 10% of the projects want to log to a different service like Google Analytics or New Relic.\nDrawbacks The drawback is that we have a global singleton that listens to router events. This can be a performance issue when you have a lot of subscriptions. Also the code is not as explicit as it was before. This can be a problem when you are debugging the application. You will have to look at the provideRouteHandler method to see what is happening.\nWe also made it very easy to add more services to the route handling. It still can be possible to create duplicate own implementations and when updating the package, the application will break. This is a risk we took and we are aware of it.\nReferences Angular Router provideRouter APP_INITIALIZER Endnotes This design was my idea but i implemented it with a colleague, so he has some of the credit of the code in this post. Jarco, thanks a lot!\nThis blogpost is the first blog post using my new Dygma Defy keyboard. I did not edit the layers yet just trying to get used to the keyboard.\n","wordCount":"1050","inLanguage":"en-us","image":"https://martdegraaf.github.io/posts/angular-singleton-services-listening-to-routing-events/cover.webp","datePublished":"2024-12-12T22:00:00+01:00","dateModified":"2024-12-14T09:28:06+01:00","author":[{"@type":"Person","name":"Mart de Graaf"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://martdegraaf.github.io/posts/angular-singleton-services-listening-to-routing-events/"},"publisher":{"@type":"Organization","name":"Mart's blog","logo":{"@type":"ImageObject","url":"https://martdegraaf.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://martdegraaf.github.io/ accesskey=h title="Mart's blog (Alt + H)">Mart's blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://martdegraaf.github.io/about title=About><span>About</span></a></li><li><a href=https://martdegraaf.github.io/archive title=Archive><span>Archive</span></a></li><li><a href=https://martdegraaf.github.io/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://martdegraaf.github.io/speaking title=Speaking><span>Speaking</span></a></li><li><a href=https://martdegraaf.github.io/tags title=Tags><span>Tags</span></a></li></ul></nav></header><main class="main page"><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Unlocking Angular Potential: Provide Root Services That Listen to Routing Events</h1><div class=post-meta><span title='2024-12-12 22:00:00 +0100 +0100'>December 12, 2024</span>&nbsp;Â·&nbsp;<span title='2024-12-14 09:28:06 +0100 +0100'>(updated December 14, 2024)</span>&nbsp;Â·&nbsp;5 min&nbsp;Â·&nbsp;1050 words&nbsp;Â·&nbsp;Mart de Graaf</div></header><figure class=entry-cover><img loading=eager srcset="https://martdegraaf.github.io/posts/angular-singleton-services-listening-to-routing-events/cover_hu17779354345644637906.webp 360w ,https://martdegraaf.github.io/posts/angular-singleton-services-listening-to-routing-events/cover_hu17643481240787923236.webp 480w ,https://martdegraaf.github.io/posts/angular-singleton-services-listening-to-routing-events/cover_hu6129926525149841347.webp 720w ,https://martdegraaf.github.io/posts/angular-singleton-services-listening-to-routing-events/cover.webp 1024w" sizes="(min-width: 768px) 720px, 100vw" src=https://martdegraaf.github.io/posts/angular-singleton-services-listening-to-routing-events/cover.webp alt="Image featuring Angular" width=1024 height=1024></figure><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#system-context aria-label="System context">System context</a></li><li><a href=#solution aria-label=Solution>Solution</a><ul><li><a href=#the-root-listener aria-label="The root listener">The root listener</a></li><li><a href=#the-sub-services aria-label="The sub services">The sub services</a><ul><li><a href=#titleservice aria-label=TitleService>TitleService</a></li><li><a href=#pageviewlogger aria-label=PageViewLogger>PageViewLogger</a></li></ul></li><li><a href=#implementing-in-your-application aria-label="Implementing in your application">Implementing in your application</a></li></ul></li><li><a href=#conclusion-and-discussion aria-label="Conclusion and discussion">Conclusion and discussion</a><ul><li><a href=#benefits aria-label=Benefits>Benefits</a></li><li><a href=#drawbacks aria-label=Drawbacks>Drawbacks</a></li></ul></li><li><a href=#references aria-label=References>References</a></li><li><a href=#endnotes aria-label=Endnotes>Endnotes</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).parentNode.classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).parentNode.classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).parentNode.classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p><strong>In a project with over 50 Angular projects we had quite some duplicate code. The first thing you will think of is putting code in a NPM package. But that can be a challenge when some of the 50 had a different implementation.</strong></p><h1 id=system-context>System context<a hidden class=anchor aria-hidden=true href=#system-context>#</a></h1><p>The applications we make are wizard like applications. We update the title on a route change. This is done by subscribing to the router events.
In the Angular projects we had this code sample in the <code>app.component.ts</code>:</p><div class=codecontainer hi=mart><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>public</span> <span class=nx>AppComponent</span><span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>public</span> <span class=kr>constructor</span><span class=p>(</span><span class=kr>private</span> <span class=nx>router</span>: <span class=kt>Router</span><span class=p>,</span> <span class=kr>private</span> <span class=nx>titleService</span>: <span class=kt>Title</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>handleRouterEvent</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>private</span> <span class=nx>handleRouterEvent</span><span class=p>()</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>router</span><span class=p>.</span><span class=nx>events</span><span class=p>.</span><span class=nx>pipe</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>takeUntill</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>destroy$</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>filter</span><span class=p>((</span><span class=nx>event</span><span class=p>)</span> <span class=o>:</span> <span class=nx>event</span> <span class=k>is</span> <span class=nx>NavigationEnd</span> <span class=o>=&gt;</span> <span class=nx>event</span> <span class=nx>instanceOf</span> <span class=nx>NavigationEnd</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>).</span><span class=nx>subscribe</span><span class=p>((</span><span class=nx>event</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>titleService</span><span class=p>.</span><span class=nx>setTitle</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>getTitle</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>url</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div><h1 id=solution>Solution<a hidden class=anchor aria-hidden=true href=#solution>#</a></h1><p>The solution was found using the <code>APP_INITIALIZER</code> token. This token is used to run a function before the application is bootstrapped. When using this method we can create a singleton service that does not need to be depended upon in the constructor of the components.</p><h2 id=the-root-listener>The root listener<a hidden class=anchor aria-hidden=true href=#the-root-listener>#</a></h2><div class=codecontainer hi=mart><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kd>@Injectable</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>providedIn</span><span class=o>:</span> <span class=s1>&#39;root&#39;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>RouteHandlerService</span> <span class=kr>implements</span> <span class=nx>OnDestroy</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>private</span> <span class=nx>destroy$</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Subject</span><span class=p>&lt;</span><span class=nt>void</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=kr>constructor</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=kr>private</span> <span class=nx>router</span>: <span class=kt>Router</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=kd>@Inject</span><span class=p>(</span><span class=s1>&#39;ROUTE_HANDLING_LISTENERS&#39;</span><span class=p>)</span> <span class=kr>private</span> <span class=nx>subServices</span>: <span class=kt>RouteHandlerSubService</span><span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>startListening</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>private</span> <span class=nx>startListening</span><span class=p>()</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>router</span><span class=p>.</span><span class=nx>events</span><span class=p>.</span><span class=nx>pipe</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>takeUntill</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>destroy$</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>filter</span><span class=p>((</span><span class=nx>event</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>event</span> <span class=k>instanceof</span> <span class=nx>NavigationEnd</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>map</span><span class=p>((</span><span class=nx>event</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>event</span> <span class=kr>as</span> <span class=nx>NavigationEnd</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>).</span><span class=nx>subscribe</span><span class=p>((</span><span class=nx>event</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>titleService</span><span class=p>.</span><span class=nx>setTitle</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>getTitle</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>url</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>public</span> <span class=nx>ngOnDestroy</span><span class=p>()</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>destroy$</span><span class=p>.</span><span class=nx>next</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>destroy$</span><span class=p>.</span><span class=nx>complete</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kd>function</span> <span class=nx>provideRouteHandler</span><span class=p>(...</span><span class=nx>subServices</span>: <span class=kt>Provider</span><span class=p>[][])</span><span class=o>:</span> <span class=nx>Provider</span><span class=p>[]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span><span class=nx>subServices</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>service</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>service</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>provide</span>: <span class=kt>APP_INITIALIZER</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>useFactory</span><span class=o>:</span> <span class=p>(</span><span class=nx>routeHandlerService</span>: <span class=kt>RouteHandlerService</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>routeHandlerService</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>deps</span><span class=o>:</span> <span class=p>[</span><span class=nx>RouteHandlerService</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=nx>multi</span>: <span class=kt>true</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div><h2 id=the-sub-services>The sub services<a hidden class=anchor aria-hidden=true href=#the-sub-services>#</a></h2><p>We have some actions that need to be done on navigation such as logging a page view and setting the title of the page. We can create a sub service for this. This sub service can be injected in the <code>provideRouteHandler</code> method.</p><h3 id=titleservice>TitleService<a hidden class=anchor aria-hidden=true href=#titleservice>#</a></h3><div class=codecontainer hi=mart><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kd>@Injectable</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>providedIn</span><span class=o>:</span> <span class=s1>&#39;root&#39;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>TitleService</span> <span class=kr>implements</span> <span class=nx>RouteHandlerSubService</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>constructor</span><span class=p>(</span><span class=kr>private</span> <span class=nx>titleService</span>: <span class=kt>Title</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=kr>public</span> <span class=nx>handleRoute</span><span class=p>(</span><span class=nx>event</span>: <span class=kt>NavigationEnd</span><span class=p>)</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>titleService</span><span class=p>.</span><span class=nx>setTitle</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>getTitle</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>url</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kd>function</span> <span class=nx>withTitleService</span><span class=p>()</span><span class=o>:</span> <span class=nx>Provider</span><span class=p>[]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=nx>TitleService</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>provide</span><span class=o>:</span> <span class=s1>&#39;ROUTE_HANDLING_LISTENERS&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>useExisting</span>: <span class=kt>TitleService</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>multi</span>: <span class=kt>true</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div><h3 id=pageviewlogger>PageViewLogger<a hidden class=anchor aria-hidden=true href=#pageviewlogger>#</a></h3><div class=codecontainer hi=mart><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kd>@Injectable</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>providedIn</span><span class=o>:</span> <span class=s1>&#39;root&#39;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>PageViewLogger</span> <span class=kr>implements</span> <span class=nx>RouteHandlerSubService</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>constructor</span><span class=p>(</span><span class=kr>private</span> <span class=nx>logger</span>: <span class=kt>LoggingService</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=kr>public</span> <span class=nx>handleRoute</span><span class=p>(</span><span class=nx>event</span>: <span class=kt>NavigationEnd</span><span class=p>)</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>logger</span><span class=p>.</span><span class=nx>logPageView</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>url</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kd>function</span> <span class=nx>withPageViewLogger</span><span class=p>()</span><span class=o>:</span> <span class=nx>Provider</span><span class=p>[]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=nx>PageViewLogger</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>provide</span><span class=o>:</span> <span class=s1>&#39;ROUTE_HANDLING_LISTENERS&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>useExisting</span>: <span class=kt>PageViewLogger</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>multi</span>: <span class=kt>true</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div><h2 id=implementing-in-your-application>Implementing in your application<a hidden class=anchor aria-hidden=true href=#implementing-in-your-application>#</a></h2><p>By creating a provide method, we can configure any behaviour that is needed for that specific project. And by allowing parameters to implement this method we can extend even for specific business logic for that project. I got this idea when we migrated to a newer version of Angular and my eye fell on the <code>provideRoutes</code> method. This method is used to provide routes to the application. My solution is based on this method but implemented generic and simple.</p><p>So in your <code>main.ts</code>, you can now register the route handler like this:</p><div class=codecontainer hi=mart><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=nx>bootstapApplicaiton</span><span class=p>(</span><span class=nx>AppComponent</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>providers</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span>
</span></span><span class=line><span class=cl>        <span class=nx>provideRouteHandler</span><span class=p>(</span><span class=nx>withTitleService</span><span class=p>(),</span> <span class=nx>withPageViewLogger</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></td></tr></table></div></div></div><p>This allows even consumers to hook into those events and write their own subservice for hanlding router events.</p><h1 id=conclusion-and-discussion>Conclusion and discussion<a hidden class=anchor aria-hidden=true href=#conclusion-and-discussion>#</a></h1><p>Please don&rsquo;t use this as an golden hammer. Normally you would want to be as explicit as possible when subscribing to route events. In our case we removed complexity and variations in our codebase. Also I am not sure what kind of performance impact this has on applications. We use these subscriptions at root level, so it was a good fit for us.</p><p>Also if you are using my code here, please note it only supports <code>NavigationEnd</code> events. If you want to support more events, you should edit the design to support a method to in the service if it handles the event type. You could use the <code>Event</code> type from <code>@Angular/router</code> to do this.</p><div class=codecontainer hi=mart><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>public</span> <span class=nx>startListening</span><span class=p>()</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>router</span><span class=p>.</span><span class=nx>events</span><span class=p>.</span><span class=nx>pipe</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>takeUntill</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>destroy$</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>).</span><span class=nx>subscribe</span><span class=p>((</span><span class=nx>event</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>subServices</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>filter</span><span class=p>((</span><span class=nx>service</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>service</span><span class=p>.</span><span class=nx>handles</span><span class=p>(</span><span class=nx>event</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>service</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>service</span><span class=p>.</span><span class=nx>handle</span><span class=p>(</span><span class=nx>event</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div><h2 id=benefits>Benefits<a hidden class=anchor aria-hidden=true href=#benefits>#</a></h2><p>The move of this duplicate code over all projects also resulted in a higher code coverage and less stress to test the same code over and over again, and creating variants of the same code. It feels a lot like the Loki show of Disney+ where there are multiple Lokis in the same universe. We just restored the sacred timeline by implementing and using the package.</p><p>We are flexible in the use of the provide method. Let&rsquo;s say only one service does not want to log page views in the same way, we can just remove the <code>withPageViewLogger</code> method from the <code>provideRouteHandler</code> method. A concrete example may be when logging to application insights in 90% of the projects and 10% of the projects want to log to a different service like Google Analytics or New Relic.</p><h2 id=drawbacks>Drawbacks<a hidden class=anchor aria-hidden=true href=#drawbacks>#</a></h2><p>The drawback is that we have a global singleton that listens to router events. This can be a performance issue when you have a lot of subscriptions. Also the code is not as explicit as it was before. This can be a problem when you are debugging the application. You will have to look at the <code>provideRouteHandler</code> method to see what is happening.</p><p>We also made it very easy to add more services to the route handling. It still can be possible to create duplicate own implementations and when updating the package, the application will break. This is a risk we took and we are aware of it.</p><h1 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h1><ul><li><a href=https://angular.io/api/router/Router target=_blank rel=noopener>Angular Router</a></li><li><a href=https://angular.dev/api/router/provideRouter target=_blank rel=noopener>provideRouter</a></li><li><a href=https://angular.io/api/core/APP_INITIALIZER target=_blank rel=noopener>APP_INITIALIZER</a></li></ul><h1 id=endnotes>Endnotes<a hidden class=anchor aria-hidden=true href=#endnotes>#</a></h1><p>This design was my idea but i implemented it with a colleague, so he has some of the credit of the code in this post. Jarco, thanks a lot!</p><p><strong>This blogpost is the first blog post using my new Dygma Defy keyboard. I did not edit the layers yet just trying to get used to the keyboard.</strong></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://martdegraaf.github.io/tags/angular/>Angular</a></li><li><a href=https://martdegraaf.github.io/tags/typescript/>Typescript</a></li><li><a href=https://martdegraaf.github.io/tags/singleton/>Singleton</a></li><li><a href=https://martdegraaf.github.io/tags/design-pattern/>Design Pattern</a></li><li><a href=https://martdegraaf.github.io/tags/router/>Router</a></li><li><a href=https://martdegraaf.github.io/tags/npm/>Npm</a></li></ul><nav class=paginav><a class=next href=https://martdegraaf.github.io/posts/bicep-template-spec-latest/><span class=title>Â»</span><br><span>Bicep Template Spec Latest</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Unlocking Angular Potential: Provide Root Services That Listen to Routing Events on x" href="https://x.com/intent/tweet/?text=Unlocking%20Angular%20Potential%3a%20Provide%20Root%20Services%20That%20Listen%20to%20Routing%20Events&amp;url=https%3a%2f%2fmartdegraaf.github.io%2fposts%2fangular-singleton-services-listening-to-routing-events%2f&amp;hashtags=Angular%2ctypescript%2csingleton%2cdesignpattern%2crouter%2cnpm"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Unlocking Angular Potential: Provide Root Services That Listen to Routing Events on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fmartdegraaf.github.io%2fposts%2fangular-singleton-services-listening-to-routing-events%2f&amp;title=Unlocking%20Angular%20Potential%3a%20Provide%20Root%20Services%20That%20Listen%20to%20Routing%20Events&amp;summary=Unlocking%20Angular%20Potential%3a%20Provide%20Root%20Services%20That%20Listen%20to%20Routing%20Events&amp;source=https%3a%2f%2fmartdegraaf.github.io%2fposts%2fangular-singleton-services-listening-to-routing-events%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Unlocking Angular Potential: Provide Root Services That Listen to Routing Events on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fmartdegraaf.github.io%2fposts%2fangular-singleton-services-listening-to-routing-events%2f&title=Unlocking%20Angular%20Potential%3a%20Provide%20Root%20Services%20That%20Listen%20to%20Routing%20Events"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Unlocking Angular Potential: Provide Root Services That Listen to Routing Events on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fmartdegraaf.github.io%2fposts%2fangular-singleton-services-listening-to-routing-events%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Unlocking Angular Potential: Provide Root Services That Listen to Routing Events on whatsapp" href="https://api.whatsapp.com/send?text=Unlocking%20Angular%20Potential%3a%20Provide%20Root%20Services%20That%20Listen%20to%20Routing%20Events%20-%20https%3a%2f%2fmartdegraaf.github.io%2fposts%2fangular-singleton-services-listening-to-routing-events%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Unlocking Angular Potential: Provide Root Services That Listen to Routing Events on telegram" href="https://telegram.me/share/url?text=Unlocking%20Angular%20Potential%3a%20Provide%20Root%20Services%20That%20Listen%20to%20Routing%20Events&amp;url=https%3a%2f%2fmartdegraaf.github.io%2fposts%2fangular-singleton-services-listening-to-routing-events%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Unlocking Angular Potential: Provide Root Services That Listen to Routing Events on ycombinator" href="https://news.ycombinator.com/submitlink?t=Unlocking%20Angular%20Potential%3a%20Provide%20Root%20Services%20That%20Listen%20to%20Routing%20Events&u=https%3a%2f%2fmartdegraaf.github.io%2fposts%2fangular-singleton-services-listening-to-routing-events%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><script src=https://giscus.app/client.js data-repo=martdegraaf/martdegraaf.github.io data-repo-id=R_kgDOHu1qyg data-category=General data-category-id=DIC_kwDOHu1qys4CfotY data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-lang=en data-loading=lazy crossorigin=anonymous async></script><script>window.setInterval(function(){const e=document.querySelector("iframe.giscus-frame");if(!e)return;document.body.classList.contains("dark")?e.contentWindow.postMessage({giscus:{setConfig:{theme:"dark"}}},"https://giscus.app"):e.contentWindow.postMessage({giscus:{setConfig:{theme:"light"}}},"https://giscus.app")},1e3)</script></article></main><footer class=footer><span>Mart de Graaf</span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>