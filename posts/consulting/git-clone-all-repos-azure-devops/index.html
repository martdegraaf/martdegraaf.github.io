<!doctype html><html lang=en-us dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Efficiently Git Clone All Repositories from Azure DevOps using PowerShell: A Step-by-Step Guide | Mart's blog</title>
<meta name=keywords content="Git,Powershell,Azure DevOps,Consulting,Automation"><meta name=description content="Learn how to efficiently clone all Git repos in Azure DevOps with our comprehensive consulting guide. Streamline your development workflow today!"><meta name=author content="Mart de Graaf"><link rel=canonical href=https://martdegraaf.github.io/posts/consulting/git-clone-all-repos-azure-devops/><link crossorigin=anonymous href=/assets/css/stylesheet.bfd15e69260c6082053df917afa1377f3ec5863b45e4f9c0ad06267a66fdaf58.css integrity="sha256-v9FeaSYMYIIFPfkXr6E3fz7FhjtF5PnArQYmemb9r1g=" rel="preload stylesheet" as=style><link rel=icon href=https://martdegraaf.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://martdegraaf.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://martdegraaf.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://martdegraaf.github.io/apple-touch-icon.png><link rel=mask-icon href=https://martdegraaf.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en-us href=https://martdegraaf.github.io/posts/consulting/git-clone-all-repos-azure-devops/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=text/javascript>!function(e,t,n){var s,o=e.location,f="script",m="connectionString",a="ingestionendpoint",d="disableExceptionTracking",l="ai.device.",c="toLowerCase",r="crossOrigin",u="POST",h="appInsightsSDK",i=n.name||"appInsights";(n.name||e[h])&&(e[h]=i),s=e[i]||function(s){var p,g,v,j,C,k=!1,b=!1,i={initialize:!0,queue:[],sv:"5",version:2,config:s};function y(e,t){var n={},s="Browser";return n[l+"id"]=s[c](),n[l+"type"]=s,n["ai.operation.name"]=o&&o.pathname||"_unknown_",n["ai.internal.sdkVersion"]="javascript:snippet_"+(i.sv||i.version),{time:function(){var e=new Date;function t(e){var t=""+e;return 1===t.length&&(t="0"+t),t}return e.getUTCFullYear()+"-"+t(1+e.getUTCMonth())+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+((e.getUTCMilliseconds()/1e3).toFixed(3)+"").slice(2,5)+"Z"}(),name:"Microsoft.ApplicationInsights."+e.replace(/-/g,"")+"."+t,sampleRate:100,tags:n,data:{baseData:{ver:2}}}}if(g=s.url||n.src,g){function E(){var r,l,d,h,f,p,v,j,_,w,O;k=!0,i.queue=[],b||(b=!0,l=g,h=function(){var t,n,o,i,r,e={},l=s.connectionString;if(l)for(o=l.split(";"),t=0;t<o.length;t++)n=o[t].split("="),2===n.length&&(e[n[0][c]()]=n[1]);return e[a]||(i=e.endpointsuffix,r=i?e.location:null,e[a]="https://"+(r?r+".":"")+"dc."+(i||"services.visualstudio.com")),e}(),f=h[m]||s[m]||"",p=h[a],r=p?p+"/v2/track":s.endpointUrl,(v=[]).push((d="SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details)",j=l,_=r,(O=(w=y(f,"Exception")).data).baseType="ExceptionData",O.baseData.exceptions=[{typeName:"SDKLoadFailed",message:d.replace(/\./g,"-"),hasFullStack:!1,stack:d+`
Snippet failed to load [`+j+`] -- Telemetry is disabled
Help Link: https://go.microsoft.com/fwlink/?linkid=2128109
Host: `+(o&&o.pathname||"_unknown_")+`
Endpoint: `+_,parsedStack:[]}],w)),v.push(function(e,t,n,s){var o,i=y(f,"Message"),a=i.data;return a.baseType="MessageData",o=a.baseData,o.message='AI (Internal): 99 message:"'+("SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details) ("+n+")").replace(/"/g,"")+'"',o.properties={endpoint:s},i}(0,0,l,r)),function(t,s){if(JSON){var o,i=e.fetch;i&&!n.useXhr?i(s,{method:u,body:JSON.stringify(t),mode:"cors"}):XMLHttpRequest&&(o=new XMLHttpRequest,o.open(u,s),o.setRequestHeader("Content-type","application/json"),o.send(JSON.stringify(t)))}}(v,r))}function w(e,t){b||setTimeout(function(){!t&&i.core||E()},500)}v=function(){var s,e=t.createElement(f);return e.src=g,s=n[r],!s&&""!==s||"undefined"==e[r]||(e[r]=s),e.onload=w,e.onerror=E,e.onreadystatechange=function(t,n){"loaded"!==e.readyState&&"complete"!==e.readyState||w(0,n)},e}(),n.ld<0?t.getElementsByTagName("head")[0].appendChild(v):setTimeout(function(){t.getElementsByTagName(f)[0].parentNode.appendChild(v)},n.ld||0)}try{i.cookie=t.cookie}catch{}function _(e){for(;e.length;)!function(e){i[e]=function(){var t=arguments;k||i.queue.push(function(){i[e].apply(i,t)})}}(e.pop())}var h="track",O="TrackPage",x="TrackEvent";return _([h+"Event",h+"PageView",h+"Exception",h+"Trace",h+"DependencyData",h+"Metric",h+"PageViewPerformance","start"+O,"stop"+O,"start"+x,"stop"+x,"addTelemetryInitializer","setAuthenticatedUserContext","clearAuthenticatedUserContext","flush"]),i.SeverityLevel={Verbose:0,Information:1,Warning:2,Error:3,Critical:4},C=(s.extensionConfig||{}).ApplicationInsightsAnalytics||{},!0!==s[d]&&!0!==C[d]&&(p="onerror",_(["_"+p]),j=e[p],e[p]=function(e,t,n,s,o){var a=j&&j(e,t,n,s,o);return!0!==a&&i["_"+p]({message:e,url:t,lineNumber:n,columnNumber:s,error:o}),a},s.autoExceptionInstrumented=!0),i}(n.cfg);function p(){n.onInit&&n.onInit(s)}(e[i]=s).queue&&0===s.queue.length?(s.queue.push(p),s.trackPageView({})):p()}(window,document,{src:"https://js.monitor.azure.com/scripts/b/ai.2.min.js",crossOrigin:"anonymous",cfg:{connectionString:"InstrumentationKey=90cb325b-804c-43a9-97dd-9f34e5a0be01;IngestionEndpoint=https://westeurope-5.in.applicationinsights.azure.com/;LiveEndpoint=https://westeurope.livediagnostics.monitor.azure.com/",autoTrackPageVisitTime:!0}})</script><link rel=stylesheet href=/css/github.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZFQGR29JJQ"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-ZFQGR29JJQ")}</script><meta property="og:title" content="Efficiently Git Clone All Repositories from Azure DevOps using PowerShell: A Step-by-Step Guide"><meta property="og:description" content="Learn how to efficiently clone all Git repos in Azure DevOps with our comprehensive consulting guide. Streamline your development workflow today!"><meta property="og:type" content="article"><meta property="og:url" content="https://martdegraaf.github.io/posts/consulting/git-clone-all-repos-azure-devops/"><meta property="og:image" content="https://martdegraaf.github.io/posts/consulting/git-clone-all-repos-azure-devops/cover.webp"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-15T18:14:56+01:00"><meta property="article:modified_time" content="2024-05-02T21:34:05+02:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://martdegraaf.github.io/posts/consulting/git-clone-all-repos-azure-devops/cover.webp"><meta name=twitter:title content="Efficiently Git Clone All Repositories from Azure DevOps using PowerShell: A Step-by-Step Guide"><meta name=twitter:description content="Learn how to efficiently clone all Git repos in Azure DevOps with our comprehensive consulting guide. Streamline your development workflow today!"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://martdegraaf.github.io/posts/"},{"@type":"ListItem","position":2,"name":"","item":"https://martdegraaf.github.io/posts/consulting/"},{"@type":"ListItem","position":3,"name":"Efficiently Git Clone All Repositories from Azure DevOps using PowerShell: A Step-by-Step Guide","item":"https://martdegraaf.github.io/posts/consulting/git-clone-all-repos-azure-devops/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Efficiently Git Clone All Repositories from Azure DevOps using PowerShell: A Step-by-Step Guide","name":"Efficiently Git Clone All Repositories from Azure DevOps using PowerShell: A Step-by-Step Guide","description":"Learn how to efficiently clone all Git repos in Azure DevOps with our comprehensive consulting guide. Streamline your development workflow today!","keywords":["Git","Powershell","Azure DevOps","Consulting","Automation"],"articleBody":"As a consultant, starting a new project with a client can be a daunting task. One way to make the transition smoother is by cloning all the repositories on your first day. This allows you to have quick access to all the necessary files and resources, enabling you to perform your job efficiently and effectively. In this blog post, we will explore the benefits of cloning repositories, a script for doing so, and some common pitfalls to avoid.\nSkip to the code sample\nOrganizing your Git repos When working for multiple clients or even just having private projects next to your client projects it can come in handy to organize your git repositories. For some Frontend repositories, the path with node_modules was too long and that forced me to place my folders on the Disk level. A path for a project for me would look like C:\\Git\\{ClientName}\\{RepositoryName}.\n1 2 3 4 5 6 7 8 9 10 11 C:\\Git ┣ Client1 ┃ ┣ Client1.Repository1 ┃ ┣ Client1.Repository2 ┃ ┗ Client1.Repository3 ┣ Client2 ┃ ┣ Client2.Repository1 ┃ ┗ Client2.Repository2 ┗ private ┃ ┣ Blog ┃ ┗ Demo Using workspaces in Git Fork Fork is a tool that will help you focus on the right workload. Using the structure as discussed with Fork, you can focus on the right repositories. Cloned new repositories but not seen by Fork? Reload the whole folder using right-click and ‘Rescan repositories’. Get Git Fork from git-fork.com.\nFork Repository Manager Use Fork Workspaces to focus on the current environment. It will also help you work on private projects outside of work hours on the same workstation. You can also create workspaces for different domains or teams if you are for example the lead or architect in a project.\nFork workspaces Configure your git username Depending on the network infra, you will need to configure your commit username to the email of your client. Some instances block all git pushes from committers with a different domain.\n1 git config [--global] user.email \"username@corperate.com\" In the script to clone all repositories, you can also enable the script to set the committer email for every repository.\nClone all repositories To clone all repositories in Azure DevOps we can use the REST API to find all existing repositories. The code example consists of a Powershell script and a configuration file with settings and Authorization.\nConfiguration Make sure to create a file named: CloneAllRepos.config with the contents written below. Make sure every parameter is configured as your workspace.\nCloneAllRepos.config 1 2 3 4 5 6 7 8 9 10 [General] Url=https://dev.azure.com/MART/project [LocalGitConfig] GitPath=C:\\Git\\ OrgName=MART [GitOptions] PruneLocalBranches=false # Optional defaults to false GitEmail=username@corperate.com 💡 Don’t know where to find a Personal Access Token in Azure DevOps? Read: Microsoft’s docs on personal access tokens.\nOn 2024 april 17, I updated the script to get an access token using the current session of the az cli. see Azure DevOps API Authentication.\nCloneAllRepos.ps1 When I first encountered the idea to clone all repos idea it was on a corporate wiki. After some backtracing, I found the source: Script to clone all Git repositories from your Azure DevOps collection.\nThe PowerShell script below does a git pull for existing repositories and performs a git clone on untracked repositories.\nI edited the script to fit my needs with some extra parameters.\nIt puts the repos in the given directory in settings. It prunes local branches when PruneLocalBranches is set to true. It sets the git username email to the configured GitUsername under GitOptions, it’s ignored when empty. CloneAllRepos.ps1 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 # Read configuration file Get-Content \"CloneAllRepos.config\" | foreach-object -begin {$h=@{}} -process { $k = [regex]::split($_,'='); if(($k[0].CompareTo(\"\") -ne 0) -and ($k[0].StartsWith(\"[\") -ne $True)) { $h.Add($k[0], $k[1]) } } #AzDO config $url = $h.Get_Item(\"Url\") # LocalGitConfig $gitPath = $h.Get_Item(\"GitPath\") $orgName = $h.Get_Item(\"OrgName\") $pruneLocalBranches = $h.Get_Item(\"PruneLocalBranches\") -eq \"true\" $gitEmail = $h.Get_Item(\"GitEmail\") # Get the access token from current az login session # see https://learn.microsoft.com/en-us/azure/devops/integrate/get-started/authentication/service-principal-managed-identity?toc=%2Fazure%2Fdevops%2Forganizations%2Fsecurity%2Ftoc.json\u0026view=azure-devops#q-can-i-use-a-service-principal-or-managed-identity-with-azure-cli $accessToken = az account get-access-token --resource 499b84ac-1321-427f-aa17-267ca6975798 --query \"accessToken\" --output tsv if ($null -eq $accessToken) { exit 1 } $headers = @{ \"Authorization\" = (\"Bearer {0}\" -f $accessToken) \"Accept\" = \"application/json\" } # Retrieve list of all repositories $resp = Invoke-WebRequest -Headers $headers -Uri (\"{0}/_apis/git/repositories?api-version=1.0\" -f $url) $json = convertFrom-JSON $resp.Content # Clone or pull all repositories $initpath = (\"{0}{1}\" -f $gitPath,$orgName) foreach ($entry in $json.value) { set-location $initpath $name = $entry.name Write-Host $name -ForegroundColor Green if($entry.isDisabled){ Write-Host \"Skipping disabled repo: '$name'\" -ForegroundColor Yellow continue; } $url = $entry.remoteUrl #-replace \"://\", (\"://{0}@\" -f $gitcred) if(!(Test-Path -Path $name)) { git clone $url } else { Write-Host \"Directory '$name' exists lets pull\" set-location $name git pull $defaultBranch = git symbolic-ref --short HEAD if($pruneLocalBranches){ Write-Host \"Pruning local branches $name\" -ForegroundColor Yellow $branches = git branch -vv | Where-Object { $_ -notmatch \"::\" } | ForEach-Object { ($_ -split '\\s+')[1] } foreach ($branch in $branches) { if ($branch -eq $defaultBranch) { Write-Host \"Skipping default branch '$branch'.\" continue } if ((git branch -vv | Where-Object { $_ -match \"$branch\\s+\\[origin\\/\" })) { Write-Host \"Skipping branch '$branch' as it has a remote reference.\" } else { git branch -D $branch Write-Host \"Deleted local branch '$branch'.\" -ForegroundColor Green } } } if($gitEmail){ git config user.email \"$gitEmail\" } } } 🤖 If you have some additional ideas, let ChatGPT help you. Supply ChatGPt with the context: Rewrite this PowerShell script to also . Here is the current version of the PowerShell script: .. Let me know if you thought of a clever solution. Run it Run the script it using a PowerShell prompt for example using for example Windows Terminal.\n1 ./CloneAllRepos.ps1 Using scripting for common tasks In the world of microservices, we choose to duplicate some of the plumbing. When you want to change multiple repos knowledge on scripting can be helpful. In this series, I explored how to automate git tasks with PowerShell.\nSome examples are:\nUpdating multiple NuGet packages. Enforcing certain Nuget. config configurations. Renaming business terminology on multiple branches. Automating With this structure, you could automate actions over multiple repositories. In the code below I wrote an example of automating script for changing the Nuget.config file in every repository. If your packages have the same layout changes can be done easier and faster. Also, please check out my article using binary replace.\n1 2 3 4 5 6 7 8 9 10 11 12 git checkout main git pull git checkout -b fix/nugetconfig # DO THE NECESSARY CHANGE in nuget.config. git mv -f NuGet.config nuget.config git add * git commit -m \"Only use private Nuget upstream\" git push --set-upstream origin fix/nugetconfig git checkout main Conclusion and discussion Make your workflow faster with scripting and your knowledge of the Git CLI. When you have to do repetitive tasks such as updating a single package on multiple (microservice-like) repositories, try to automate it. It may for the first occurrence not be profitable, but after three times, you will be faster than doing it manually. It can also help you clean up your workspace and be more tidy.\n","wordCount":"1240","inLanguage":"en-us","image":"https://martdegraaf.github.io/posts/consulting/git-clone-all-repos-azure-devops/cover.webp","datePublished":"2023-05-15T18:14:56+01:00","dateModified":"2024-05-02T21:34:05+02:00","author":[{"@type":"Person","name":"Mart de Graaf"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://martdegraaf.github.io/posts/consulting/git-clone-all-repos-azure-devops/"},"publisher":{"@type":"Organization","name":"Mart's blog","logo":{"@type":"ImageObject","url":"https://martdegraaf.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://martdegraaf.github.io/ accesskey=h title="Mart's blog (Alt + H)">Mart's blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://martdegraaf.github.io/about title=About><span>About</span></a></li><li><a href=https://martdegraaf.github.io/archive title=Archive><span>Archive</span></a></li><li><a href=https://martdegraaf.github.io/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://martdegraaf.github.io/speaking title=Speaking><span>Speaking</span></a></li><li><a href=https://martdegraaf.github.io/tags title=Tags><span>Tags</span></a></li></ul></nav></header><main class="main page"><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Efficiently Git Clone All Repositories from Azure DevOps using PowerShell: A Step-by-Step Guide</h1><div class=post-meta><span title='2023-05-15 18:14:56 +0100 +0100'>May 15, 2023</span>&nbsp;·&nbsp;<span title='2024-05-02 21:34:05 +0200 +0200'>(updated May 2, 2024)</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1240 words&nbsp;·&nbsp;Mart de Graaf</div></header><figure class=entry-cover><img loading=eager srcset="https://martdegraaf.github.io/posts/consulting/git-clone-all-repos-azure-devops/cover_hu14565524397574145980.webp 360w ,https://martdegraaf.github.io/posts/consulting/git-clone-all-repos-azure-devops/cover_hu2096908065885323654.webp 480w ,https://martdegraaf.github.io/posts/consulting/git-clone-all-repos-azure-devops/cover_hu70077035033790945.webp 720w ,https://martdegraaf.github.io/posts/consulting/git-clone-all-repos-azure-devops/cover.webp 1024w" sizes="(min-width: 768px) 720px, 100vw" src=https://martdegraaf.github.io/posts/consulting/git-clone-all-repos-azure-devops/cover.webp alt="A digital workspace with multiple computer screens displaying code and command lines." width=1024 height=1024><p>A digital workspace with multiple computer screens displaying code and command lines.</p></figure><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#organizing-your-git-repos aria-label="Organizing your Git repos">Organizing your Git repos</a><ul><li><a href=#using-workspaces-in-git-fork aria-label="Using workspaces in Git Fork">Using workspaces in Git Fork</a></li><li><a href=#configure-your-git-username aria-label="Configure your git username">Configure your git username</a></li></ul></li><li><a href=#clone-all-repositories aria-label="Clone all repositories">Clone all repositories</a><ul><li><a href=#configuration aria-label=Configuration>Configuration</a></li><li><a href=#cloneallreposps1 aria-label=CloneAllRepos.ps1>CloneAllRepos.ps1</a></li><li><a href=#run-it aria-label="Run it">Run it</a></li></ul></li><li><a href=#using-scripting-for-common-tasks aria-label="Using scripting for common tasks">Using scripting for common tasks</a><ul><li><a href=#automating aria-label=Automating>Automating</a></li></ul></li><li><a href=#conclusion-and-discussion aria-label="Conclusion and discussion">Conclusion and discussion</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).parentNode.classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).parentNode.classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).parentNode.classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>As a consultant, starting a new project with a client can be a daunting task. One way to make the transition smoother is by cloning all the repositories on your first day. This allows you to have quick access to all the necessary files and resources, enabling you to perform your job efficiently and effectively. In this blog post, we will explore the benefits of cloning repositories, a script for doing so, and some common pitfalls to avoid.</p><p><a href=#configuration>Skip to the code sample</a></p><h2 id=organizing-your-git-repos>Organizing your Git repos<a hidden class=anchor aria-hidden=true href=#organizing-your-git-repos>#</a></h2><p>When working for multiple clients or even just having private projects next to your client projects it can come in handy to organize your git repositories. For some Frontend repositories, the path with node_modules was too long and that forced me to place my folders on the Disk level. A path for a project for me would look like <code>C:\Git\{ClientName}\{RepositoryName}</code>.</p><div class=codecontainer hi=mart><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>C:\Git
</span></span><span class=line><span class=cl> ┣ Client1
</span></span><span class=line><span class=cl> ┃ ┣ Client1.Repository1
</span></span><span class=line><span class=cl> ┃ ┣ Client1.Repository2
</span></span><span class=line><span class=cl> ┃ ┗ Client1.Repository3
</span></span><span class=line><span class=cl> ┣ Client2
</span></span><span class=line><span class=cl> ┃ ┣ Client2.Repository1
</span></span><span class=line><span class=cl> ┃ ┗ Client2.Repository2
</span></span><span class=line><span class=cl> ┗ private
</span></span><span class=line><span class=cl> ┃ ┣ Blog
</span></span><span class=line><span class=cl> ┃ ┗ Demo</span></span></code></pre></td></tr></table></div></div></div><h3 id=using-workspaces-in-git-fork>Using workspaces in Git Fork<a hidden class=anchor aria-hidden=true href=#using-workspaces-in-git-fork>#</a></h3><p>Fork is a tool that will help you focus on the right workload. Using the structure as discussed with Fork, you can focus on the right repositories. Cloned new repositories but not seen by Fork? Reload the whole folder using right-click and &lsquo;Rescan repositories&rsquo;. Get Git Fork from <a href=https://git-fork.com/ target=_blank rel=noopener>git-fork.com</a>.</p><p><figure><img loading=lazy src=fork_repository_manager.png#center alt="Fork Repository Manager" title="Fork Repository Manager"><figcaption style=text-align:center>Fork Repository Manager</figcaption></figure></p><p>Use Fork Workspaces to focus on the current environment. It will also help you work on private projects outside of work hours on the same workstation. You can also create workspaces for different domains or teams if you are for example the lead or architect in a project.</p><p><figure><img loading=lazy src=fork_workspaces.png#center alt="Fork Workspaces" title="Fork workspaces"><figcaption style=text-align:center>Fork workspaces</figcaption></figure></p><h3 id=configure-your-git-username>Configure your git username<a hidden class=anchor aria-hidden=true href=#configure-your-git-username>#</a></h3><p>Depending on the network infra, you will need to configure your commit username to the email of your client.
Some instances block all git pushes from committers with a different domain.</p><div class=codecontainer hi=mart><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>git config [--global] user.email &#34;username@corperate.com&#34;
</span></span></span></code></pre></td></tr></table></div></div></div><p>In the script to clone all repositories, you can also enable the script to set the committer email for every repository.</p><h2 id=clone-all-repositories>Clone all repositories<a hidden class=anchor aria-hidden=true href=#clone-all-repositories>#</a></h2><p>To clone all repositories in Azure DevOps we can use the REST API to find all existing repositories. The code example consists of a Powershell script and a configuration file with settings and Authorization.</p><h3 id=configuration>Configuration<a hidden class=anchor aria-hidden=true href=#configuration>#</a></h3><p>Make sure to create a file named: <code>CloneAllRepos.config</code> with the contents written below. Make sure every parameter is configured as your workspace.</p><div class=codecontainer hi=mart><div class=code-name>CloneAllRepos.config</div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cfg data-lang=cfg><span class=line><span class=cl><span class=k>[General]</span>
</span></span><span class=line><span class=cl><span class=na>Url</span><span class=o>=</span><span class=s>https://dev.azure.com/MART/project</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[LocalGitConfig]</span>
</span></span><span class=line><span class=cl><span class=na>GitPath</span><span class=o>=</span><span class=s>C:\Git\</span>
</span></span><span class=line><span class=cl><span class=na>OrgName</span><span class=o>=</span><span class=s>MART</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[GitOptions]</span>
</span></span><span class=line><span class=cl><span class=na>PruneLocalBranches</span><span class=o>=</span><span class=s>false # Optional defaults to false</span>
</span></span><span class=line><span class=cl><span class=na>GitEmail</span><span class=o>=</span><span class=s>username@corperate.com</span></span></span></code></pre></td></tr></table></div></div></div><div style="border:#0078d3 1px solid;padding:15px;background:var(--entry);border-left-width:3px"><p>&#x1f4a1; <del>Don&rsquo;t know where to find a Personal Access Token in Azure DevOps? Read: <a href=https://learn.microsoft.com/en-us/azure/devops/organizations/accounts/use-personal-access-tokens-to-authenticate target=_blank rel=noopener>Microsoft&rsquo;s docs on personal access tokens</a>.</del></p><p>On 2024 april 17, I updated the script to get an access token using the current session of the az cli. see <a href="https://learn.microsoft.com/en-us/azure/devops/integrate/get-started/authentication/service-principal-managed-identity?toc=%2Fazure%2Fdevops%2Forganizations%2Fsecurity%2Ftoc.json&amp;view=azure-devops#q-can-i-use-a-service-principal-or-managed-identity-with-azure-cli" target=_blank rel=noopener>Azure DevOps API Authentication</a>.</p></div><h3 id=cloneallreposps1>CloneAllRepos.ps1<a hidden class=anchor aria-hidden=true href=#cloneallreposps1>#</a></h3><p>When I first encountered the idea to clone all repos idea it was on a corporate wiki. After some backtracing, I found the source: <a href=https://blog.rsuter.com/script-to-clone-all-git-repositories-from-your-vsts-collection/ target=_blank rel=noopener>Script to clone all Git repositories from your Azure DevOps collection</a>.</p><p>The PowerShell script below does a <code>git pull</code> for existing repositories and performs a <code>git clone</code> on untracked repositories.</p><p>I edited the script to fit my needs with some extra parameters.</p><ol><li>It puts the repos in the given directory in settings.</li><li>It prunes local branches when <code>PruneLocalBranches</code> is set to true.</li><li>It sets the git username email to the configured <code>GitUsername</code> under GitOptions, it&rsquo;s ignored when empty.</li></ol><div class=codecontainer hi=mart><div class=code-name>CloneAllRepos.ps1</div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=c># Read configuration file</span>
</span></span><span class=line><span class=cl><span class=nb>Get-Content</span> <span class=s2>&#34;CloneAllRepos.config&#34;</span> <span class=p>|</span> <span class=nb>foreach-object</span> <span class=n>-begin</span> <span class=p>{</span><span class=nv>$h</span><span class=p>=</span><span class=vm>@</span><span class=p>{}}</span> <span class=n>-process</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=nv>$k</span> <span class=p>=</span> <span class=p>[</span><span class=no>regex</span><span class=p>]::</span><span class=n>split</span><span class=p>(</span><span class=nv>$_</span><span class=p>,</span><span class=s1>&#39;=&#39;</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>((</span><span class=nv>$k</span><span class=p>[</span><span class=mf>0</span><span class=p>].</span><span class=py>CompareTo</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>)</span> <span class=o>-ne</span> <span class=mf>0</span><span class=p>)</span> <span class=o>-and</span> <span class=p>(</span><span class=nv>$k</span><span class=p>[</span><span class=mf>0</span><span class=p>].</span><span class=py>StartsWith</span><span class=p>(</span><span class=s2>&#34;[&#34;</span><span class=p>)</span> <span class=o>-ne</span> <span class=vm>$True</span><span class=p>))</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>        <span class=nv>$h</span><span class=p>.</span><span class=py>Add</span><span class=p>(</span><span class=nv>$k</span><span class=p>[</span><span class=mf>0</span><span class=p>],</span> <span class=nv>$k</span><span class=p>[</span><span class=mf>1</span><span class=p>])</span> 
</span></span><span class=line><span class=cl>    <span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c>#AzDO config</span>
</span></span><span class=line><span class=cl><span class=nv>$url</span> <span class=p>=</span> <span class=nv>$h</span><span class=p>.</span><span class=py>Get_Item</span><span class=p>(</span><span class=s2>&#34;Url&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c># LocalGitConfig</span>
</span></span><span class=line><span class=cl><span class=nv>$gitPath</span> <span class=p>=</span> <span class=nv>$h</span><span class=p>.</span><span class=py>Get_Item</span><span class=p>(</span><span class=s2>&#34;GitPath&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nv>$orgName</span> <span class=p>=</span> <span class=nv>$h</span><span class=p>.</span><span class=py>Get_Item</span><span class=p>(</span><span class=s2>&#34;OrgName&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nv>$pruneLocalBranches</span> <span class=p>=</span> <span class=nv>$h</span><span class=p>.</span><span class=py>Get_Item</span><span class=p>(</span><span class=s2>&#34;PruneLocalBranches&#34;</span><span class=p>)</span> <span class=o>-eq</span> <span class=s2>&#34;true&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$gitEmail</span> <span class=p>=</span> <span class=nv>$h</span><span class=p>.</span><span class=py>Get_Item</span><span class=p>(</span><span class=s2>&#34;GitEmail&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Get the access token from current az login session</span>
</span></span><span class=line><span class=cl><span class=c># see https://learn.microsoft.com/en-us/azure/devops/integrate/get-started/authentication/service-principal-managed-identity?toc=%2Fazure%2Fdevops%2Forganizations%2Fsecurity%2Ftoc.json&amp;view=azure-devops#q-can-i-use-a-service-principal-or-managed-identity-with-azure-cli</span>
</span></span><span class=line><span class=cl><span class=nv>$accessToken</span> <span class=p>=</span> <span class=n>az</span> <span class=n>account</span> <span class=nb>get-access</span><span class=n>-token</span> <span class=p>-</span><span class=n>-resource</span> <span class=n>499b84ac</span><span class=p>-</span><span class=mf>1321</span><span class=p>-</span><span class=mf>427f</span><span class=n>-aa17</span><span class=p>-</span><span class=n>267ca6975798</span> <span class=p>-</span><span class=n>-query</span> <span class=s2>&#34;accessToken&#34;</span> <span class=p>-</span><span class=n>-output</span> <span class=n>tsv</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=vm>$null</span> <span class=o>-eq</span> <span class=nv>$accessToken</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>exit</span> <span class=mf>1</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$headers</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Authorization&#34;</span> <span class=p>=</span> <span class=p>(</span><span class=s2>&#34;Bearer {0}&#34;</span> <span class=o>-f</span> <span class=nv>$accessToken</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Accept&#34;</span> <span class=p>=</span> <span class=s2>&#34;application/json&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Retrieve list of all repositories</span>
</span></span><span class=line><span class=cl><span class=nv>$resp</span> <span class=p>=</span> <span class=nb>Invoke-WebRequest</span> <span class=n>-Headers</span> <span class=nv>$headers</span> <span class=n>-Uri</span> <span class=p>(</span><span class=s2>&#34;{0}/_apis/git/repositories?api-version=1.0&#34;</span> <span class=o>-f</span> <span class=nv>$url</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nv>$json</span> <span class=p>=</span> <span class=nb>convertFrom-JSON</span> <span class=nv>$resp</span><span class=p>.</span><span class=py>Content</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Clone or pull all repositories</span>
</span></span><span class=line><span class=cl><span class=nv>$initpath</span> <span class=p>=</span>  <span class=p>(</span><span class=s2>&#34;{0}{1}&#34;</span> <span class=o>-f</span>  <span class=nv>$gitPath</span><span class=p>,</span><span class=nv>$orgName</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>foreach</span> <span class=p>(</span><span class=nv>$entry</span> <span class=k>in</span> <span class=nv>$json</span><span class=p>.</span><span class=n>value</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=nb>set-location</span> <span class=nv>$initpath</span>
</span></span><span class=line><span class=cl>    <span class=nv>$name</span> <span class=p>=</span> <span class=nv>$entry</span><span class=p>.</span><span class=py>name</span> 
</span></span><span class=line><span class=cl>    <span class=nb>Write-Host</span> <span class=nv>$name</span> <span class=n>-ForegroundColor</span> <span class=n>Green</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nv>$entry</span><span class=p>.</span><span class=n>isDisabled</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nb>Write-Host</span> <span class=s2>&#34;Skipping disabled repo: &#39;</span><span class=nv>$name</span><span class=s2>&#39;&#34;</span> <span class=n>-ForegroundColor</span> <span class=n>Yellow</span>
</span></span><span class=line><span class=cl>        <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$url</span> <span class=p>=</span> <span class=nv>$entry</span><span class=p>.</span><span class=py>remoteUrl</span> <span class=c>#-replace &#34;://&#34;, (&#34;://{0}@&#34; -f $gitcred)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(!(</span><span class=nb>Test-Path</span> <span class=n>-Path</span> <span class=nv>$name</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>git</span> <span class=n>clone</span> <span class=nv>$url</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>Write-Host</span> <span class=s2>&#34;Directory &#39;</span><span class=nv>$name</span><span class=s2>&#39; exists lets pull&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>set-location</span> <span class=nv>$name</span>
</span></span><span class=line><span class=cl>        <span class=n>git</span> <span class=n>pull</span>
</span></span><span class=line><span class=cl>        <span class=nv>$defaultBranch</span> <span class=p>=</span> <span class=n>git</span> <span class=nb>symbolic-ref</span> <span class=p>-</span><span class=n>-short</span> <span class=n>HEAD</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$pruneLocalBranches</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=nb>Write-Host</span> <span class=s2>&#34;Pruning local branches </span><span class=nv>$name</span><span class=s2>&#34;</span> <span class=n>-ForegroundColor</span> <span class=n>Yellow</span>
</span></span><span class=line><span class=cl>            <span class=nv>$branches</span> <span class=p>=</span> <span class=n>git</span> <span class=n>branch</span> <span class=n>-vv</span> <span class=p>|</span> <span class=nb>Where-Object</span> <span class=p>{</span> <span class=nv>$_</span> <span class=o>-notmatch</span> <span class=s2>&#34;::&#34;</span> <span class=p>}</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span> <span class=p>(</span><span class=nv>$_</span> <span class=n>-split</span> <span class=s1>&#39;\s+&#39;</span><span class=p>)[</span><span class=mf>1</span><span class=p>]</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>foreach</span> <span class=p>(</span><span class=nv>$branch</span> <span class=k>in</span> <span class=nv>$branches</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nv>$branch</span> <span class=o>-eq</span> <span class=nv>$defaultBranch</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nb>Write-Host</span> <span class=s2>&#34;Skipping default branch &#39;</span><span class=nv>$branch</span><span class=s2>&#39;.&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=k>continue</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>((</span><span class=n>git</span> <span class=n>branch</span> <span class=n>-vv</span> <span class=p>|</span> <span class=nb>Where-Object</span> <span class=p>{</span> <span class=nv>$_</span> <span class=o>-match</span> <span class=s2>&#34;</span><span class=nv>$branch</span><span class=s2>\s+\[origin\/&#34;</span> <span class=p>}))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nb>Write-Host</span> <span class=s2>&#34;Skipping branch &#39;</span><span class=nv>$branch</span><span class=s2>&#39; as it has a remote reference.&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>git</span> <span class=n>branch</span> <span class=n>-D</span> <span class=nv>$branch</span>
</span></span><span class=line><span class=cl>                    <span class=nb>Write-Host</span> <span class=s2>&#34;Deleted local branch &#39;</span><span class=nv>$branch</span><span class=s2>&#39;.&#34;</span> <span class=n>-ForegroundColor</span> <span class=n>Green</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$gitEmail</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=n>git</span> <span class=n>config</span> <span class=n>user</span><span class=p>.</span><span class=py>email</span> <span class=s2>&#34;</span><span class=nv>$gitEmail</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div><div style="border:#0078d3 1px solid;padding:15px;background:var(--entry);border-left-width:3px">&#x1f916; If you have some additional ideas, let ChatGPT help you. Supply ChatGPt with the context: <code>Rewrite this PowerShell script to also &lt;insert new Feature>. Here is the current version of the PowerShell script: &lt;insert PowerShell script>.</code>. Let me know if you thought of a clever solution.</div><h3 id=run-it>Run it<a hidden class=anchor aria-hidden=true href=#run-it>#</a></h3><p>Run the script it using a PowerShell prompt for example using for example Windows Terminal.</p><div class=codecontainer hi=mart><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=p>./</span><span class=n>CloneAllRepos</span><span class=p>.</span><span class=n>ps1</span></span></span></code></pre></td></tr></table></div></div></div><h2 id=using-scripting-for-common-tasks>Using scripting for common tasks<a hidden class=anchor aria-hidden=true href=#using-scripting-for-common-tasks>#</a></h2><p>In the world of microservices, we choose to duplicate some of the plumbing. When you want to change multiple repos knowledge on scripting can be helpful. In this series, I explored how to automate git tasks with PowerShell.</p><p>Some examples are:</p><ul><li>Updating multiple NuGet packages.</li><li>Enforcing certain <code>Nuget.</code> <code>config</code> configurations.</li><li>Renaming business terminology on multiple branches.</li></ul><h3 id=automating>Automating<a hidden class=anchor aria-hidden=true href=#automating>#</a></h3><p>With this structure, you could automate actions over multiple repositories. In the code below I wrote an example of automating script for changing the Nuget.config file in every repository. If your packages have the same layout changes can be done easier and faster. Also, please check out <a href=https://martdegraaf.github.io/posts/replacing-your-projects-and-namespaces-using-bire/>my article using binary replace</a>.</p><div class=codecontainer hi=mart><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=n>git</span> <span class=n>checkout</span> <span class=n>main</span>
</span></span><span class=line><span class=cl><span class=n>git</span> <span class=n>pull</span>
</span></span><span class=line><span class=cl><span class=n>git</span> <span class=n>checkout</span> <span class=n>-b</span> <span class=n>fix</span><span class=p>/</span><span class=n>nugetconfig</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># DO THE NECESSARY CHANGE in nuget.config.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>git</span> <span class=nb>mv </span><span class=o>-f</span> <span class=n>NuGet</span><span class=p>.</span><span class=py>config</span> <span class=n>nuget</span><span class=p>.</span><span class=py>config</span>
</span></span><span class=line><span class=cl><span class=n>git</span> <span class=n>add</span> <span class=p>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>git</span> <span class=n>commit</span> <span class=n>-m</span> <span class=s2>&#34;Only use private Nuget upstream&#34;</span>
</span></span><span class=line><span class=cl><span class=n>git</span> <span class=n>push</span> <span class=p>-</span><span class=n>-set-upstream</span> <span class=n>origin</span> <span class=n>fix</span><span class=p>/</span><span class=n>nugetconfig</span>
</span></span><span class=line><span class=cl><span class=n>git</span> <span class=n>checkout</span> <span class=n>main</span></span></span></code></pre></td></tr></table></div></div></div><h2 id=conclusion-and-discussion>Conclusion and discussion<a hidden class=anchor aria-hidden=true href=#conclusion-and-discussion>#</a></h2><p>Make your workflow faster with scripting and your knowledge of the Git CLI. When you have to do repetitive tasks such as updating a single package on multiple (microservice-like) repositories, try to automate it. It may for the first occurrence not be profitable, but after three times, you will be faster than doing it manually. It can also help you clean up your workspace and be more tidy.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://martdegraaf.github.io/tags/git/>Git</a></li><li><a href=https://martdegraaf.github.io/tags/powershell/>Powershell</a></li><li><a href=https://martdegraaf.github.io/tags/azure-devops/>Azure DevOps</a></li><li><a href=https://martdegraaf.github.io/tags/consulting/>Consulting</a></li><li><a href=https://martdegraaf.github.io/tags/automation/>Automation</a></li></ul><nav class=paginav><a class=prev href=https://martdegraaf.github.io/posts/consulting/filter-devops-mentions-in-outlook/><span class=title>«</span><br><span>Efficiently use Outlook Rules to Delete Azure DevOps Email Clutter</span>
</a><a class=next href=https://martdegraaf.github.io/posts/replacing-your-projects-and-namespaces-using-bire/><span class=title>»</span><br><span>Replacing Your Projects and Namespaces Using Bire</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Efficiently Git Clone All Repositories from Azure DevOps using PowerShell: A Step-by-Step Guide on x" href="https://x.com/intent/tweet/?text=Efficiently%20Git%20Clone%20All%20Repositories%20from%20Azure%20DevOps%20using%20PowerShell%3a%20A%20Step-by-Step%20Guide&amp;url=https%3a%2f%2fmartdegraaf.github.io%2fposts%2fconsulting%2fgit-clone-all-repos-azure-devops%2f&amp;hashtags=Git%2cPowershell%2cAzureDevOps%2cConsulting%2cAutomation"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Efficiently Git Clone All Repositories from Azure DevOps using PowerShell: A Step-by-Step Guide on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fmartdegraaf.github.io%2fposts%2fconsulting%2fgit-clone-all-repos-azure-devops%2f&amp;title=Efficiently%20Git%20Clone%20All%20Repositories%20from%20Azure%20DevOps%20using%20PowerShell%3a%20A%20Step-by-Step%20Guide&amp;summary=Efficiently%20Git%20Clone%20All%20Repositories%20from%20Azure%20DevOps%20using%20PowerShell%3a%20A%20Step-by-Step%20Guide&amp;source=https%3a%2f%2fmartdegraaf.github.io%2fposts%2fconsulting%2fgit-clone-all-repos-azure-devops%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Efficiently Git Clone All Repositories from Azure DevOps using PowerShell: A Step-by-Step Guide on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fmartdegraaf.github.io%2fposts%2fconsulting%2fgit-clone-all-repos-azure-devops%2f&title=Efficiently%20Git%20Clone%20All%20Repositories%20from%20Azure%20DevOps%20using%20PowerShell%3a%20A%20Step-by-Step%20Guide"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Efficiently Git Clone All Repositories from Azure DevOps using PowerShell: A Step-by-Step Guide on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fmartdegraaf.github.io%2fposts%2fconsulting%2fgit-clone-all-repos-azure-devops%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Efficiently Git Clone All Repositories from Azure DevOps using PowerShell: A Step-by-Step Guide on whatsapp" href="https://api.whatsapp.com/send?text=Efficiently%20Git%20Clone%20All%20Repositories%20from%20Azure%20DevOps%20using%20PowerShell%3a%20A%20Step-by-Step%20Guide%20-%20https%3a%2f%2fmartdegraaf.github.io%2fposts%2fconsulting%2fgit-clone-all-repos-azure-devops%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Efficiently Git Clone All Repositories from Azure DevOps using PowerShell: A Step-by-Step Guide on telegram" href="https://telegram.me/share/url?text=Efficiently%20Git%20Clone%20All%20Repositories%20from%20Azure%20DevOps%20using%20PowerShell%3a%20A%20Step-by-Step%20Guide&amp;url=https%3a%2f%2fmartdegraaf.github.io%2fposts%2fconsulting%2fgit-clone-all-repos-azure-devops%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Efficiently Git Clone All Repositories from Azure DevOps using PowerShell: A Step-by-Step Guide on ycombinator" href="https://news.ycombinator.com/submitlink?t=Efficiently%20Git%20Clone%20All%20Repositories%20from%20Azure%20DevOps%20using%20PowerShell%3a%20A%20Step-by-Step%20Guide&u=https%3a%2f%2fmartdegraaf.github.io%2fposts%2fconsulting%2fgit-clone-all-repos-azure-devops%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><script src=https://giscus.app/client.js data-repo=martdegraaf/martdegraaf.github.io data-repo-id=R_kgDOHu1qyg data-category=General data-category-id=DIC_kwDOHu1qys4CfotY data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-lang=en data-loading=lazy crossorigin=anonymous async></script><script>window.setInterval(function(){const e=document.querySelector("iframe.giscus-frame");if(!e)return;document.body.classList.contains("dark")?e.contentWindow.postMessage({giscus:{setConfig:{theme:"dark"}}},"https://giscus.app"):e.contentWindow.postMessage({giscus:{setConfig:{theme:"light"}}},"https://giscus.app")},1e3)</script></article></main><footer class=footer><span>Mart de Graaf</span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>