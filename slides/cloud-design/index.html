<!doctype html><html lang=en><head><meta charset=utf-8><title>Cloud design patterns</title>
<meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.4.0/reset.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.4.0/reveal.css><link rel=stylesheet href=/_.min.003ae097b902d49b67a44ff773fea1b7643d2cfea99aad916697c2d49adb241d.css id=theme><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/color-brewer.min.css><meta name=robots content="noindex"></head><body><style>#logo{position:absolute;top:2%;right:2%;width:15%}</style><img id=logo src=/images/4dotnet_logo.png alt><div class=reveal><div class=slides><section><section data-shortcode-section><h1 id=cloud-design-patterns>Cloud design patterns</h1><h2 id=building-resilient-net-applications>Building Resilient .NET Applications</h2><h3 id=using-polly>Using Polly</h3><p>by Mart de Graaf</p><aside class=notes><p>&rsquo;s&rsquo; - type &rsquo;s&rsquo; to enter speaker mode, which opens a separate window with a time and speaker notes
&lsquo;o&rsquo; - type &lsquo;o&rsquo; to enter overview mode and scroll through slide thumbnails
&lsquo;f&rsquo; - type &lsquo;f&rsquo; to go into full-screen mode</p><p>Design Patterns:</p><ul><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/ target=_blank rel=noopener>https://learn.microsoft.com/en-us/azure/architecture/patterns/</a></li></ul></aside></section><section><p><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/ target=_blank rel=noopener>https://learn.microsoft.com/en-us/azure/architecture/patterns/</a></p></section><section><h2 id=agenda>Agenda</h2><ol><li>Introduction to Resilience in Cloud Applications</li><li>Polly for .NET</li><li>Key Polly Policies and Use Cases</li><li>Demo and Q&amp;A</li></ol></section></section><section><h2 id=resilience-in-cloud-applications>Resilience in Cloud Applications</h2><ul><li><strong>Definition</strong></li><li><strong>Importance</strong></li><li><strong>Solution</strong></li></ul><aside class=notes><ul><li><strong>Definition</strong>: Resilience is the ability of an application to withstand and recover from failures.</li><li><strong>Importance</strong>:<ul><li>Cloud applications face network latency, server failures, and service outages.</li><li>Ensuring reliability and uptime is crucial for user experience.</li></ul></li><li><strong>Solution</strong>: Use resilience patterns like retries, circuit breakers, and fallback policies.</li></ul></aside></section><section><section data-shortcode-section><h2 id=polly-for-net>Polly for .NET</h2><p><strong>Polly</strong> is a .NET library for handling transient faults and implementing resilience and transient-fault-handling policies.</p><ul><li><strong>Key Features</strong>:<ul><li>Retry</li><li>Circuit Breaker</li><li>Timeout</li><li>Bulkhead Isolation</li><li>Fallback</li></ul></li></ul><aside class=notes><p><a href=https://www.nuget.org/packages/polly/ target=_blank rel=noopener>https://www.nuget.org/packages/polly/</a></p></aside></section><section><p><strong>Benefits</strong>:</p><ul><li>Easy to implement.</li><li>Works with synchronous and asynchronous operations.</li><li>Lightweight and extensible.</li></ul></section><section><h2 id=polly-policies-overview>Polly Policies Overview</h2><ul><li><strong>Retry</strong>: Repeats a failed operation a defined number of times.</li><li><strong>Circuit Breaker</strong>: Temporarily stops requests when failures exceed a threshold.</li><li><strong>Timeout</strong>: Limits how long an operation can take before failing.</li><li><strong>Bulkhead Isolation</strong>: Isolates parts of an application to contain failures.</li><li><strong>Fallback</strong>: Specifies a backup action when the primary operation fails.</li></ul></section></section><section><h2 id=key-polly-policies-and-code-examples>Key Polly Policies and Code Examples</h2><h3 id=retry-policy>Retry Policy</h3><pre><code class=language-csharp data-line-numbers data-ln-start-from=1>var retryPolicy = Policy
    .Handle&lt;HttpRequestException&gt;()
    .RetryAsync(3);

await retryPolicy.ExecuteAsync(() =&gt;
    HttpClient.GetAsync(&#34;https://api.example.com&#34;)
);</code></pre></section><section><h3 id=circuit-breaker-policy>Circuit Breaker Policy</h3><pre><code class=language-csharp data-line-numbers data-ln-start-from=1>var circuitBreakerPolicy = Policy
    .Handle&lt;HttpRequestException&gt;()
    .CircuitBreakerAsync(2, TimeSpan.FromMinutes(1));

await circuitBreakerPolicy.ExecuteAsync(() =&gt;
    HttpClient.GetAsync(&#34;https://api.example.com&#34;)
);</code></pre></section><section><h2 id=advanced-circuit-breaker-policy>Advanced Circuit Breaker Policy</h2><pre><code class=language-csharp data-line-numbers data-ln-start-from=1>CircuitBreaker = Policy
	.Handle&lt;HttpException&gt;()
	.AdvancedCircuitBreakerAsync(
		failureThreshold: 0.5, // 50%
		samplingDuration: TimeSpan.FromMinutes(5),
		minimumThroughput: 5,
		durationOfBreak: TimeSpan.FromMinutes(5),
		(ex, breakDelay) =&gt;
		{
			// Log that the service is offline
		},
		() =&gt;
		{
			// Log that the service is back online
		},
		() =&gt;
		{
            // Log that the service is under stress
		}
	);</code></pre></section><section><h3 id=circuit-breaker-health-check>Circuit Breaker Health check</h3><p>A snippet in a <code>StartUp.cs</code> file:</p><pre><code class=language-csharp data-line-numbers data-ln-start-from=1>services.AddHealthChecks()

.AddCheck&lt;ISomeCoolClient&gt;(&#34;External API&#34;, (service, token) =&gt; service.CircuitState switch
{
    CircuitState.Open =&gt; HealthCheckResult.Degraded(&#34;Too many errors have occurred recently, will wait for a while and retry.&#34;),
    CircuitState.Isolated =&gt; HealthCheckResult.Degraded(&#34;Service disabled manually&#34;),
    CircuitState.HalfOpen =&gt; HealthCheckResult.Degraded(&#34;Service was offline after errors, ready to try again.&#34;),
    CircuitState.Closed =&gt; HealthCheckResult.Healthy(&#34;Service ready&#34;),
    _ =&gt; HealthCheckResult.Unhealthy($&#34;Circuit breaker has an unknown state {service.CircuitState}.&#34;)
})</code></pre></section><section><section data-shortcode-section><h2 id=integrating-polly>Integrating Polly</h2><ul><li><strong>Why Integrate Polly?</strong><ul><li>Adds resilience to external calls, reducing the impact of transient errors.</li><li>Helps applications recover from brief outages and service interruptions.</li></ul></li></ul></section><section><ul><li><strong>Use Cases</strong>:<ul><li>Retry logic with Azure Cosmos DB, Azure Blob Storage, and other services.</li><li>Circuit breaking for external dependencies.</li><li>Timeout policies for long-running operations.</li><li>Fallback strategies for failed requests.</li></ul></li></ul></section></section><section><h2 id=polly-best-practices>Polly best practices</h2><ul><li>Dont handle the <code>System.Exception</code> type.</li><li>Don&rsquo;t DDOS your service using the Retry policy. Use the <code>WaitAndRetry</code> policy for exponential backoff.</li><li>Use the <code>CircuitBreaker</code> policy to prevent cascading failures.</li></ul></section><section><h2 id=demo-time>Demo Time!</h2><ol><li>Set up a .NET project with Polly and Azure SDK packages.</li><li>Implement a retry policy for an REST API.</li><li>Test the policy with transient errors.</li></ol></section><section><h2 id=resources>Resources</h2><ul><li><strong>Polly Documentation</strong>: <a href=https://github.com/App-vNext/Polly target=_blank rel=noopener>https://github.com/App-vNext/Polly</a></li><li><strong>Azure SDK for .NET Documentation</strong>: <a href=https://docs.microsoft.com/en-us/dotnet/azure/ target=_blank rel=noopener>https://docs.microsoft.com/en-us/dotnet/azure/</a></li></ul></section><section><h2 id=qa>Q&amp;A</h2><p><strong>Questions?</strong></p><p>Let&rsquo;s dive deeper into Polly and Azure SDK best practices.</p></section></div></div><script type=text/javascript src=/reveal-hugo/object-assign.js></script><a href=https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.4.0/print/ id=print-location style=display:none></a><script type=text/javascript>var printLocationElement=document.getElementById("print-location"),link=document.createElement("link");link.rel="stylesheet",link.type="text/css",link.href=printLocationElement.href+(window.location.search.match(/print-pdf/gi)?"pdf.css":"paper.css"),document.getElementsByTagName("head")[0].appendChild(link)</script><script type=application/json id=reveal-hugo-site-params>{"custom_theme":"4dotnet-theme.scss","custom_theme_compile":true,"highlight_cdn":"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0","highlight_theme":"color-brewer","history":true,"margin":0.2,"reveal_cdn":"https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.4.0","slide_number":true,"theme":"black","transition":"convex","transition_speed":"fast"}</script><script type=application/json id=reveal-hugo-page-params>null</script><script src=https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.4.0/reveal.js></script><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.4.0/plugin/markdown/markdown.js></script><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.4.0/plugin/highlight/highlight.js></script><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.4.0/plugin/zoom/zoom.js></script><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.4.0/plugin/search/search.js></script><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.4.0/plugin/notes/notes.js></script><script type=text/javascript>function camelize(e){return e&&Object.keys(e).forEach(function(t){newK=t.replace(/(_\w)/g,function(e){return e[1].toUpperCase()}),newK!=t&&(e[newK]=e[t],delete e[t])}),e}var revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams=JSON.parse(document.getElementById("reveal-hugo-site-params").innerHTML),revealHugoPageParams=JSON.parse(document.getElementById("reveal-hugo-page-params").innerHTML),options=Object.assign({hash:!0,plugins:[RevealMarkdown,RevealNotes,RevealHighlight,RevealZoom,RevealSearch]},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams));Reveal.initialize(options)</script><script type=text/javascript src=/mermaid.min_16862243754454536095.js></script><script type=text/javascript>mermaid.initialize({startOnLoad:!1});let render=e=>{let t=e.currentSlide.querySelectorAll(".mermaid");if(!t.length)return;t.forEach(e=>{let t=e.getAttribute("data-processed");t||mermaid.init(void 0,e)})};render({currentSlide:Reveal.getCurrentSlide()}),Reveal.addEventListener("slidechanged",render),Reveal.addEventListener("ready",render)</script></body></html>